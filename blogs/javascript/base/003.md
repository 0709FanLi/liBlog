---
title: åƒåœ¾å›æ”¶å’Œå†…å­˜æ³„æ¼
date: 2021-09-01
tags:
  - åŸºç¡€
categories:
  - javascript
sidebar: "auto"
---

## åƒåœ¾å›æ”¶

### æ˜¯ä¹ˆæ˜¯åƒåœ¾å›æ”¶ï¼Ÿ

[**åƒåœ¾å›æ”¶**æ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œç”¨äºæè¿°æŸ¥æ‰¾å’Œåˆ é™¤é‚£äº›ä¸å†è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨çš„å¯¹è±¡çš„å¤„ç†è¿‡ç¨‹ã€‚æ¢å¥è¯è¯´ï¼Œåƒåœ¾å›æ”¶æ˜¯åˆ é™¤ä»»ä½•å…¶å®ƒå¯¹è±¡æœªä½¿ç”¨çš„å¯¹è±¡çš„è¿‡ç¨‹ã€‚åƒåœ¾å›æ”¶é€šå¸¸ç¼©å†™ä¸º'GC'ï¼Œå¼ javascript ä¸­ä½¿ç”¨çš„å†…å­˜ç®¡ç†ç³»ç»Ÿçš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚](https://developer.mozilla.org/zh-CN/docs/Glossary/Garbage_collection)

### ä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼Ÿ

åœ¨ js ä¸­ï¼ŒV8 åªèƒ½ä½¿ç”¨ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†å†…å­˜ï¼Œ64 ä½ç³»ç»Ÿä¸‹æœ€å¤šèƒ½åˆ†é… 1.4G å†…å­˜ï¼Œ32 ä½ç³»ç»Ÿä¸­ 0.7Gï¼Œè¿™æ ·çš„å†…å­˜å…¶å®å¹¶ä¸å¤§ï¼Œnodejs é‡åˆ°ä¸€ä¸ª 2G çš„æ–‡ä»¶,å¯èƒ½å°±æ— æ³•è¿›è¡Œå†™å…¥å†…å­˜è¿›è¡Œå„ç§æ“ä½œäº†.

- ä¸ºä»€ä¹ˆå†…å­˜åˆ†é…æœ‰ä¸Šé™?

1. js çš„å•çº¿ç¨‹æœºåˆ¶
   æ„å‘³ç€ä¸€æ—¦è¿›å…¥åƒåœ¾å›æ”¶ï¼Œå°±æ— æ³•è¿›è¡Œå…¶å®ƒä»»åŠ¡äº†ï¼Œé€ æˆå¡é¡¿ã€‚
2. åƒåœ¾å›æ”¶çš„é™åˆ¶
   åƒåœ¾å›æ”¶æ˜¯ä¸€ä»½ååˆ†è€—æ—¶çš„æ“ä½œï¼ŒV8 å®˜æ–¹æ˜¯è¿™æ ·å½¢å®¹çš„

```
ä»¥ 1.5GB çš„åƒåœ¾å›æ”¶å †å†…å­˜ä¸ºä¾‹ï¼ŒV8 åšä¸€æ¬¡å°çš„åƒåœ¾å›æ”¶éœ€è¦50ms ä»¥ä¸Šï¼Œåšä¸€æ¬¡éå¢é‡å¼(ps:åé¢ä¼šè§£é‡Š)çš„åƒåœ¾å›æ”¶ç”šè‡³è¦ 1s ä»¥ä¸Šã€‚
```

é‰´äºè¿™äº›åŸå› ï¼ŒV8 åšäº†ä¸€ä¸ªç²—æš´çš„é€‰æ‹©ï¼Œé™åˆ¶å†…å­˜ï¼Œ1.4 0.7 ç”±æ­¤è€Œæ¥ã€‚å½“ç„¶è¿™ä¸ªå†…å­˜æ˜¯å¯ä»¥è°ƒæ•´çš„ï¼Œ

```
// è¿™æ˜¯è°ƒæ•´è€ç”Ÿä»£è¿™éƒ¨åˆ†çš„å†…å­˜ï¼Œå•ä½æ˜¯MBã€‚åé¢ä¼šè¯¦ç»†ä»‹ç»æ–°ç”Ÿä»£å’Œè€ç”Ÿä»£å†…å­˜
node --max-old-space-size=2048 xxx.js
```

æˆ–è€…

```
// è¿™æ˜¯è°ƒæ•´æ–°ç”Ÿä»£è¿™éƒ¨åˆ†çš„å†…å­˜ï¼Œå•ä½æ˜¯ KBã€‚
node --max-new-space-size=2048 xxx.js
```

### æ€ä¹ˆè¿›è¡Œåƒåœ¾å›æ”¶çš„ï¼Ÿ

v8 æŠŠå †å†…å­˜åˆ†ä¸ºä¸¤éƒ¨åˆ†â€”â€”â€”æ–°ç”Ÿä»£å†…å­˜å’Œè€ç”Ÿä»£å†…å­˜ï¼Œæ–°ç”Ÿä»£å†…å­˜å°±æ˜¯ä¸´æ—¶åˆ†é…çš„å†…å­˜ï¼Œå­˜æ´»æ—¶é—´çŸ­ï¼Œè€ç”Ÿä»£å†…å­˜æ˜¯å¸¸é©»å†…å­˜ï¼Œå­˜æ´»æ—¶é—´é•¿ã€‚
ç›—ä¸ªå›¾â€”â€”

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7d08e477e999447cb6ad5f126f64216d~tplv-k3u1fbpfcp-watermark.image)

[(2.4w å­—,å»ºè®®æ”¶è—)ğŸ˜‡ åŸç”Ÿ JS çµé­‚ä¹‹é—®(ä¸‹), å†²åˆº ğŸš€ è¿›é˜¶æœ€åä¸€å…¬é‡Œ(é™„ä¸ªäººæˆé•¿ç»éªŒåˆ†äº«)](https://juejin.cn/post/6844904004007247880)

æ–°ç”Ÿä»£å†…å­˜é»˜è®¤ä¸º 32MB å’Œ 16MBï¼Œåˆ†åˆ«å¯¹ç”¨ 64 å’Œ 32 ä½æ“ä½œç³»ç»Ÿï¼Œå¤Ÿå°äº†ï¼Œä¸´æ—¶å­˜å‚¨ç”¨çš„ï¼Œä¹Ÿèƒ½ç†è§£ã€‚

- æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶æ€ä¹ˆåšçš„å‘¢ï¼Ÿ
  é¦–å…ˆå°†æ–°ç”Ÿä»£å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼Œ

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ae6637f558f647edae4025d5e2bf5dff~tplv-k3u1fbpfcp-watermark.image)

From ä¸ºä½¿ç”¨çš„å†…å­˜ï¼ŒTo ä¸ºé—²ç½®çš„å†…å­˜ï¼Œé¦–å…ˆæ£€æŸ¥ From çš„å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå­˜æ´»ï¼Œå°±å¤åˆ¶åˆ° To å†…å­˜ä¸­ï¼Œå¦åˆ™ç›´æ¥å›æ”¶ï¼Œæ£€æŸ¥å®Œæ¯•ä¹‹åï¼ŒTo ä¸­ä¸ºä½¿ç”¨çš„å†…å­˜ï¼ŒFrom ä¸­çš„å†…å­˜è¢«å›æ”¶ï¼Œä¸ºç©ºé—²çŠ¶æ€ï¼Œè§’è‰²åè½¬ï¼Œæ£€æŸ¥ To çš„å†…å­˜ä¸­çš„å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œå¦‚æœå­˜æ´»å¤åˆ¶åˆ° From ä¸­,å¦åˆ™ç›´æ¥å›æ”¶Â·Â·Â·ï¼Œå¦‚æ­¤å¾ªç¯å›æ”¶ã€‚

ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ£€æŸ¥åˆ°éå­˜æ´»å¯¹è±¡ï¼Œç›´æ¥å›æ”¶ä¸å°±å¥½äº†å—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æ¥å›ç¿»è½¬ï¼Œè¿™æ˜¯ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œ

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bdc2c1ef35974bce9f5bec53ce7701d6~tplv-k3u1fbpfcp-watermark.image)

æ·±è‰²çš„ä»£è¡¨å­˜æ´»å¯¹è±¡ï¼Œç™½è‰²çš„ä»£è¡¨æœªä½¿ç”¨çš„å†…å­˜ï¼Œå¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼Œæœªä½¿ç”¨çš„å†…å­˜æ˜¯ä¸è¿ç»­çš„ï¼Œä¸åˆ©äºè¿›è¡Œå†…å­˜çš„åˆ†é…ï¼Œè¿™ç§é›¶æ•£çš„ç©ºé—´ä¹Ÿå«åšå†…å­˜ç¢ç‰‡ï¼Œåˆšåˆšè¯´çš„æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç®—æ³•ä¹Ÿå« Scavenge ç®—æ³•ã€‚

Scavenge ç®—æ³•ä¸»è¦å°±æ˜¯è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œåœ¨ä¸€ç³»åˆ—æ“ä½œä¹‹åï¼Œto ç©ºé—´å°±å˜æˆäº†è¿™ä¸ªæ ·å­ï¼š

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/710aff4fe80c4b3db2f4e362042f3f9c~tplv-k3u1fbpfcp-watermark.image)

è¿™æ ·å°±æ–¹ä¾¿äº†å†…å­˜çš„åˆ†é…ï¼Œä¸è¿‡ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæ–°ç”Ÿä»£å†…å­˜åªèƒ½ä½¿ç”¨ä¸€åŠï¼Œä½†æ˜¯å®ƒå­˜æ”¾çš„æ˜¯å‘¨æœŸçŸ­çš„å¯¹è±¡ï¼Œè¿™ç§å¯¹è±¡ä¸€èˆ¬å¾ˆå°‘ï¼Œå› æ­¤æ—¶é—´æ€§èƒ½éå¸¸ä¼˜ç§€ã€‚

- è€ç”Ÿä»£çš„å†…å­˜å›æ”¶
  æ–°ç”Ÿä»£å†…å­˜ä¸­å˜é‡å¦‚æœç»è¿‡å¤šæ¬¡å›æ”¶ä¾ç„¶å­˜åœ¨ï¼Œå°±ä¼šæ”¾åˆ°è€ç”Ÿä»£å†…å­˜å½“ä¸­ï¼Œè¿™ç§ç°è±¡å«åšæ™‹å‡ã€‚
  å‘ç”Ÿæ™‹å‡çš„åŸå› ï¼š

1. å·²ç»ç»å†è¿‡ä¸€æ¬¡ Scavenge å›æ”¶
2. To(é—²ç½®)ç©ºé—´çš„å†…å­˜å æ¯”è¶…è¿‡ 25%;
   è€ç”Ÿä»£å†…å­˜å½“ä¸­ä¸èƒ½å†ä½¿ç”¨ Scavenge ç®—æ³•äº†ï¼Œè€ç”Ÿä»£ç§¯ç´¯çš„å†…å­˜ä¸€èˆ¬éƒ½æ˜¯å¾ˆå¤§çš„ï¼Œå¤åˆ¶å¤§é‡å†…å­˜ï¼Œæµªè´¹ä¸€åŠå†…å­˜ç©ºé—´ã€‚

é‚£ä¹ˆè€ç”Ÿä»£æ€æ ·è¿›è¡Œåƒåœ¾å›æ”¶ï¼Ÿ

1. æ ‡è®°æ¸…é™¤ï¼Œç›®å‰åœ¨`Javascriptå¼•æ“`è¿™ç§ç®—æ³•æ˜¯æœ€å¸¸ç”¨çš„ï¼Œåˆ°ç›®å‰ä¸ºæ­¢çš„å¤§å¤šæ•°æµè§ˆå™¨çš„`Javascriptå¼•æ“`éƒ½é‡‡ç”¨æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œåªæ˜¯ä¸åŒçš„æµè§ˆå™¨å‚å•†å¯¹æ­¤ç®—æ³•åšäº†ä¸åŒçš„ä¼˜åŒ–ã€‚

æ•´ä¸ªæ ‡è®°æ¸…é™¤ç®—æ³•å¤§è‡´è¿‡ç¨‹å°±åƒä¸‹é¢è¿™æ ·ï¼š

- åƒåœ¾æ”¶é›†å™¨åœ¨è¿è¡Œæ—¶ä¼šç»™å†…å­˜ä¸­çš„æ‰€æœ‰å˜é‡éƒ½åŠ ä¸Šä¸€ä¸ªæ ‡è®°ï¼Œå‡è®¾å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯åƒåœ¾ï¼Œå…¨æ ‡è®°ä¸º 0
- ç„¶åä»å„ä¸ªæ ¹å¯¹è±¡å¼€å§‹éå†ï¼ŒæŠŠä¸æ˜¯åƒåœ¾çš„èŠ‚ç‚¹å˜ä¸º 1
- æ¸…ç†æ‰€æœ‰æ ‡è®°ä¸º 0 çš„åƒåœ¾ï¼Œé”€æ¯å¹¶å›æ”¶å®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´
- æœ€åï¼ŒæŠŠæ‰€æœ‰å†…å­˜ä¸­çš„å¯¹è±¡æ ‡è®°ä¿®æ”¹ä¸º 0ï¼Œç­‰å¾…ä¸‹ä¸€è½®åƒåœ¾å›æ”¶

æ ¹å¯¹è±¡ï¼Œåœ¨æµè§ˆå™¨ä¸­åŒ…æ‹¬åˆä¸æ­¢äº`å…¨å±€windowå¯¹è±¡`,`æ–‡æ¡£DOMæ ‘`ç­‰ï¼›

- ä¼˜ç‚¹
  æ ‡è®°æ¸…é™¤çš„ä¼˜ç‚¹åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯å®ç°æ¯”è¾ƒç®€å•ï¼Œæ ‡è®°æ— éæ˜¯æ‰“ä¸ä¸æ‰“ä¸¤ç§ï¼Œè¿™ä½¿å¾—ä¸€ä½äºŒè¿›åˆ¶ä½(0 å’Œ 1)å°±å¯ä»¥ä¸ºå…¶æ ‡è®°ï¼Œååˆ†ç®€å•ã€‚
- ç¼ºç‚¹
  è€ç”Ÿä»£å†…å­˜åŒæ ·å­˜åœ¨`å†…å­˜ç¢ç‰‡`çš„é—®é¢˜ï¼Œè€ç”Ÿä»£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ

é—®é¢˜äº§ç”Ÿçš„åŸå› ï¼Œæ˜¯å› ä¸ºåƒåœ¾æ¸…é™¤ä¹‹åå‰©ä½™å¯¹è±¡å†…å­˜ä½ç½®ä¸å˜å¼•å‘çš„é—®é¢˜ã€‚

**æ ‡è®°æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•**å°±å¯ä»¥æœ‰æ•ˆçš„è§£å†³ï¼Œä»–çš„æ ‡è®°é˜¶æ®µå’Œæ ‡è®°æ¸…é™¤ç®—æ³•æ²¡ä»€ä¹ˆä¸åŒï¼Œåªæ˜¯æ ‡è®°ç»“æŸåï¼Œæ ‡è®°æ•´ç†ç®—æ³•å°†æ´»ç€çš„å¯¹è±¡å‘å†…å­˜çš„ä¸€ç«¯ç§»åŠ¨ï¼Œæœ€åæ¸…ç†æ‰è¾¹ç•Œçš„å†…å­˜ã€‚

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0d785761f2644973842cf706624a42ba~tplv-k3u1fbpfcp-watermark.image)

**å¢é‡æ ‡è®°**

æ ‡è®°æ¸…é™¤ç®—æ³•æ˜¯ä¸€ç§å…¨åœé¡¿çš„åƒåœ¾å›æ”¶æ–¹å¼ï¼Œå¯¹äºè€ç”Ÿä»£å¤§é‡å†…å­˜æ¥è¯´ï¼Œè€—æ—¶è¿‡ä¹…ï¼Œä¸ºäº†å‡å°‘å…¨åœé¡¿æ—¶é—´ï¼Œåœ¨ 2011 å¹´ï¼ŒV8 å¯¹è€ç”Ÿä»£çš„æ ‡è®°è¿›è¡Œäº†ä¼˜åŒ–,å…¨åœé¡¿å˜ä¸ºå¢é‡æ ‡è®°ã€‚

ä»€ä¹ˆæ˜¯å¢é‡ï¼Ÿ
å¢é‡å°±æ˜¯å°†ä¸€æ¬¡æ€§è¿›è¡Œæ ‡è®°çš„ä»»åŠ¡ï¼Œåˆ†ä¸ºå¾ˆå¤šçš„å°æ­¥ï¼Œæ¯ä¸ªå°æ­¥æ‰§è¡Œå®Œä¹‹åï¼Œæ‰§è¡Œä¸€ä¼šå„¿é€»è¾‘ï¼Œè¿™æ ·äº¤æ›¿å°±å®Œæˆäº†ä¸€è½®æ ‡è®°ã€‚
![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14cd063892eb49fa86d78cfc3ebaf36b~tplv-k3u1fbpfcp-watermark.image)

ä¸‰è‰²æ ‡è®°æ³•(æš‚åœä¸å›å¤)

æ‰§è¡Œä¸€ä¼šå„¿å¢é‡åï¼Œå¦‚æœé‡‡ç”¨éé»‘å³ç™½çš„æ ‡è®°ç­–ç•¥ï¼Œæš‚åœå›å¤åè¯¥ä»å“ªå¼€å§‹æ‰§è¡Œï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ V8 å›¢é˜Ÿé‡‡ç”¨äº†ä¸€ç§ç‰¹æ®Šçš„æ–¹å¼ï¼šä¸‰è‰²æ ‡è®°æ³•

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ccbfc776adf49cdb3c7049c0194c38c~tplv-k3u1fbpfcp-watermark.image)

- ç™½è‰²æ˜¯æŒ‡æœªè¢«æ ‡è®°çš„å¯¹è±¡
- ç°è‰²æ˜¯æŒ‡è‡ªèº«è¢«æ ‡è®°ï¼Œæˆå‘˜å˜é‡æœªè¢«æ ‡è®°
- é»‘è‰²æ˜¯æŒ‡è‡ªèº«å’Œæˆå‘˜å˜é‡çš†è¢«æ ‡è®°
  æœ€å¼€å§‹éƒ½æ˜¯ç™½è‰²ï¼Œä»ä¸€ç»„æ ¹å¯¹è±¡å¼€å§‹ï¼Œå…ˆå°†æ ¹å¯¹è±¡æ”¾å…¥åˆ°æ ‡è®°åˆ—è¡¨ä¸­ï¼Œå¹¶æ”¹å˜é¢œè‰²ä¸ºç°è‰²ï¼Œå½“å¯¹è±¡çš„æˆå‘˜å˜é‡è¢«æ ‡è®°åï¼Œè‡ªèº«å˜ä¸ºé»‘è‰²ï¼Œæ— æ³•åˆ°è¾¾çš„èŠ‚ç‚¹è¿˜æ˜¯ç™½è‰²ã€‚

æš‚åœè¿‡åæ¢å¤æ‰§è¡Œï¼Œç›´æ¥æ‰¾åˆ°ç°è‰²æ ‡è®°å¹¶æ¥ç€å¾€ä¸‹æ‰§è¡Œæ ‡è®°å°±å¯ä»¥äº†ã€‚

ä¸‰è‰²æ ‡è®°æ³•ä¸éœ€è¦æ¯æ¬¡éƒ½æ‰«ææ•´ä¸ªå†…å­˜ç©ºé—´ï¼Œå‡å°‘äº†å…¨åœé¡¿æ—¶é—´ã€‚

**å†™å±éšœ**

å¦‚æœå¢é‡æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œå¼•ç”¨å…³ç³»è¢«ä¿®æ”¹æ€ä¹ˆåŠï¼Ÿ

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bc6122da836940129537f9c1e06235fa~tplv-k3u1fbpfcp-watermark.image)

B ä¸å†å¼•ç”¨ Cï¼Œè€Œå¼•ç”¨äº† Dï¼Œå› ä¸º C ç°åœ¨æ˜¯é»‘è‰²æ ‡è®°ï¼Œæ˜¯ä¸ä¼šè¢«æ¸…ç†ï¼Œä¸è¿‡æˆ‘ä»¬ä¸ç”¨è€ƒè™‘è¿™ä¸ªï¼Œå¼•ç”¨å…³ç³»æ²¡æœ‰ä¹‹åå¾ˆå¿«ä¼šè¢«æ¸…ç†ã€‚D æ˜¯ç™½è‰²ï¼ŒD å°†åœ¨æ¸…ç†é˜¶æ®µè¢«å›æ”¶ï¼Œè¿˜æœ‰å¼•ç”¨å…³ç³»å°±è¢«å›æ”¶è¿™è‚¯å®šæ˜¯ä¸å¯¹çš„ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒV8 å¢é‡å›æ”¶é‡‡ç”¨`å†™å±éšœ`çš„æ–¹æ³•,`å³å‡ºç°é»‘è‰²å¼•ç”¨ç™½è‰²ï¼Œå¼ºåˆ¶æŠŠç™½è‰²æ”¹ä¸ºç°è‰²`ï¼Œä»è€Œä¿è¯ä¸‹ä¸€æ¬¡å¯ä»¥æ­£ç¡®çš„æ ‡è®°ï¼Œè¿™ä¸ªæœºåˆ¶ä¹Ÿå«åš`å¼ºä¸‰è‰²ä¸å˜æ€§`ã€‚

**æƒ°æ€§æ¸…ç†**

å¦‚æœå¯ç”¨å†…å­˜å¯ä»¥ä½¿æˆ‘ä»¬æµç•…çš„è¿è¡Œä»£ç ï¼Œå…¶å®æ˜¯æ²¡å¿…è¦ç«‹å³è¿›è¡Œåƒåœ¾æ¸…ç†çš„ï¼Œå¯ä»¥ç¨å¾®å»¶è¿Ÿï¼Œä¹Ÿæ— éœ€ä¸€æ¬¡æ¸…ç†å®Œæ‰€æœ‰å†…å­˜ï¼Œå¯ä»¥æŒ‰éœ€é€ä¸€æ¸…ç†ç›´åˆ°æ‰€æœ‰çš„éæ´»åŠ¨å¯¹è±¡å†…å­˜è¢«æ¸…ç†å®Œæ¯•ï¼Œæ¥ç€å†æ‰§è¡Œå¢é‡æ ‡è®°ã€‚

**å¢é‡æ ‡è®°å’Œæƒ°æ€§æ¸…ç†çš„ä¼˜ç¼º**

å¢é‡æ ‡è®°å’Œæƒ°æ€§æ¸…ç†æ˜¯ä¸»çº¿ç¨‹ä¸€æ¬¡æ€§åœé¡¿çš„æ—¶é—´å¤§å¤§å‡å°‘ï¼Œæ˜¯ç¨‹åºè¿è¡Œæ›´åŠ æµç•…ï¼Œä½†æ˜¯æ€»åœé¡¿æ—¶é—´å¹¶æ²¡æœ‰å‡å°‘åè€Œç•¥æœ‰å¢åŠ ï¼Œä¸‰è‰²æ ‡è®°æ³•å’Œå†™å±éšœæ— ç–‘å¢åŠ äº†è¿è¡Œæˆæœ¬ï¼Œé™ä½åº”ç”¨ç¨‹åºçš„ååé‡ã€‚

**å¹¶å‘å›æ”¶**

![image.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa17085fc85a4a709e61da1b7217f4b9~tplv-k3u1fbpfcp-watermark.image)

å®ƒæŒ‡çš„æ˜¯åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­ï¼Œä¸»çº¿ç¨‹ä¸åœé¡¿ï¼Œè¾…åŠ©çº¿ç¨‹åœ¨åå°å®Œæˆ GC è¿‡ç¨‹ã€‚è¿™æ˜¯å¹¶å‘å›æ”¶çš„ä¼˜ç‚¹ï¼ŒåŒæ—¶è¿™ä¹Ÿæ˜¯å®ç°çš„éš¾ç‚¹ï¼Œåœ¨ä¸»çº¿ç¨‹è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå †å†…å­˜çš„å¼•ç”¨åœ°å€æ”¹å˜ï¼Œè¿›è€Œå¼•èµ·ä¸€ç³»åˆ—çš„æ”¹å˜ï¼Œæ¯”å¦‚è¯´æ ‡è®°ï¼Œå®ƒéœ€è¦é¢å¤–å®ç°ä¸€äº›è¯»å†™é”æœºåˆ¶æ¥å®ç°ã€‚

2. å¼•ç”¨è®¡æ•°æ³•
   è¿™å…¶å®æ˜¯æœ€æ—©çš„ä¸€ç§åƒåœ¾å›æ”¶ç®—æ³•ï¼Œä»–æŠŠ`å¯¹è±¡æ˜¯å¦ä¸å†éœ€è¦`ç®€åŒ–å®šä¹‰ä¸º`å¯¹è±¡æœ‰æ²¡æœ‰å…¶å®ƒå¯¹è±¡å¼•ç”¨åˆ°å®ƒ`ï¼Œå¦‚æœæ²¡æœ‰å¼•ç”¨æŒ‡å‘è¯¥å¯¹è±¡(é›¶å¼•ç”¨),å¯¹è±¡å°†è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ï¼Œç›®å‰å¾ˆå°‘ä½¿ç”¨è¿™ç§ç®—æ³•äº†ï¼Œå› ä¸ºå®ƒçš„é—®é¢˜å¾ˆå¤šï¼Œè¿˜æ˜¯éœ€è¦äº†è§£ä¸‹

å®ƒçš„ç­–ç•¥æ˜¯è·Ÿè¸ªè®°å½•æ¯ä¸ªå˜é‡å€¼è¢«ä½¿ç”¨çš„æ¬¡æ•°ï¼š

- å½“å£°æ˜äº†ä¸€ä¸ªå˜é‡å¹¶å°†ä¸€ä¸ªå¼•ç”¨ç±»å‹èµ‹å€¼ç»™è¯¥å˜é‡çš„æ—¶å€™è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°å°±ä¸º 1
- åŒä¸€ä¸ªå€¼åˆè¢«èµ‹ç»™å¦ä¸€ä¸ªå˜é‡ï¼Œå¼•ç”¨æ•°åŠ ä¸€
- è¯¥å˜é‡çš„å€¼è¢«å…¶å®ƒå€¼è¦†ç›–äº†ï¼Œåˆ™å¼•ç”¨æ¬¡æ•°å‡ä¸€
- å½“è¿™ä¸ªå€¼çš„å¼•ç”¨æ¬¡æ•°ä¸º 0 çš„æ—¶å€™ï¼Œå°±è¯´æ˜è¿™ä¸ªå€¼ä¸å†è¢«éœ€è¦äº†ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šåœ¨è¿è¡Œçš„æ—¶å€™å›æ”¶æ‰å¼•ç”¨æ¬¡æ•°ä¸º 0 çš„å€¼å ç”¨çš„å†…å­˜ã€‚

```
let A = new Object();  // å¯¹è±¡çš„å¼•ç”¨æ•°ä¸º1
let B = A;             // å¯¹è±¡çš„å¼•ç”¨æ•°ä¸º2
let A = null;          // å¯¹è±¡çš„å¼•ç”¨æ•°å‡ 1  å¯¹è±¡çš„å¼•ç”¨æ•°ä¸º 1
let B = null;          // å¯¹è±¡çš„å¼•ç”¨æ•°å‡ 1  å¯¹è±¡çš„å¼•ç”¨æ•°ä¸º 0
Â·Â·Â·                    // è¢«å›æ”¶
```

è¿™ç§å¼•ç”¨å¾ˆå®¹æ˜“é‡åˆ°ä¸€ä¸ªé—®é¢˜å¾ªç¯å¼•ç”¨ï¼Œä¾‹å¦‚

```
function gcTest(){
    let A = new Object();
    let B = new Object();
    A.b = B;
    B.a = A;
}
```

gcTest è¿™ä¸ªå‡½æ•°è°ƒç”¨ä¹‹åï¼ŒA å’Œ B æ˜¯è¦è¢«æ¸…é™¤çš„ï¼Œä½†æ˜¯æŒ‰ç…§å¼•è®¡æ•°ï¼Œå¼•ç”¨æ•°éƒ½æ˜¯ 2ï¼Œæ˜¯æ— æ³•å®Œæˆæ¸…ç†çš„ã€‚æŒ‰ç…§æ ‡è®°æ¸…é™¤çš„æ€è·¯æ¥çœ‹ä¸‹ï¼Œå½“å‡½æ•°ç»“æŸåï¼ŒgcTest è¿™ä¸ªå‡½æ•°ä¸å†è¢«ä½¿ç”¨ï¼Œé‡Œè¾¹çš„å¯¹è±¡ä¹Ÿä¼šæˆä¸ºéæ´»åŠ¨å¯¹è±¡ï¼Œè¢«æ¸…é™¤æ‰ã€‚è¿™ä¹Ÿæ˜¯åæ¥æ”¾å¼ƒå¼•ç”¨è®¡æ•°ï¼Œä½¿ç”¨æ ‡è®°æ¸…é™¤çš„åŸå› ä¹‹ä¸€ã€‚

- ä¼˜ç‚¹
  å¯¹æ¯”æ ‡è®°æ¸…é™¤ç®—æ³•å¯ä»¥çœ‹å‡ºæ¥ï¼Œå½“å¼•ç”¨ä¸º 0 çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç«‹å³å›æ”¶ã€‚

æ ‡è®°æ¸…é™¤ç®—æ³•éœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´æ¸…ç†ä¸€æ¬¡ï¼Œè¿™æ—¶å€™å¿…é¡»è¦æš‚åœå»æ‰§è¡Œï¼Œè¿˜è¦éå†æ ¹å¯¹è±¡ï¼Œè€Œå¼•ç”¨è®¡æ•°åªéœ€è¦åœ¨å¼•ç”¨çš„æ—¶å€™è®¡æ•°å°±å¯ä»¥äº†ã€‚

- ç¼ºç‚¹
  é¦–å…ˆéœ€è¦ä¸€ä¸ªè®¡æ•°å™¨ï¼Œè¿™ä¸ªè®¡æ•°å™¨éœ€è¦å ç”¨å¾ˆå¤§çš„ä½ç½®ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šå¼•ç”¨æ•°é‡çš„ä¸Šé™ï¼Œè¿˜æœ‰å°±æ˜¯å¾ªç¯åº”ç”¨æ— æ³•å›æ”¶çš„é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯æœ€ä¸¥é‡çš„ã€‚

åƒåœ¾å›æ”¶å°±è¯´åˆ°è¿™é‡Œäº†ï¼ŒåŸºæœ¬ä¸Šç†è§£äº†åƒåœ¾çš„å›æ”¶çš„æ–¹æ³•ä»¥åŠä¸ºä»€ä¹ˆè¦è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œæˆ‘æƒ³è¿™æ‰æ˜¯æœ€é‡è¦çš„ã€‚

### å†…å­˜æ³„æ¼

### ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ

å½“ä¸å†è¢«ä½¿ç”¨çš„å¯¹è±¡å†…å­˜ï¼Œæ²¡æœ‰è¢«åŠæ—¶å›æ”¶ï¼Œè¿™å°±æ˜¯å†…å­˜æ³„æ¼ã€‚

### å¸¸è§çš„å†…å­˜æ³„æ¼

### 1. ä¸æ­£å½“çš„é—­åŒ…

```
function func1(params) {
    let arr1 = new  Array(100).fill('å¼ ä¸‰');
    return function func2() {

    }
};
let resFunc1 = func1();

function func2(params) {
    let arr2 = new  Array(100).fill('å¼ ä¸‰');
    return function func2() {
        let name = arr2;
    }
};
let resFunc2 = func2();
resFunc2();
resFunc2 = null;
```

é—­åŒ… resFunc1 æ²¡æœ‰é€ æˆå†…å­˜æ³„æ¼ï¼ŒresFunc2 é€ æˆäº†å†…å­˜æ³„æ¼ï¼ŒresFunc2 ä¸­å­˜åœ¨å¯¹ arr2 çš„å¼•ç”¨ï¼Œæ²¡æœ‰è¢«å›æ”¶ï¼Œé€ æˆäº†å†…å­˜æ³„æ¼ï¼Œå½“ resFunc2 å‡½æ•°è°ƒç”¨å®Œæˆä¹‹åï¼ŒresFunc2 = null,åˆ‡æ–­å¼•ç”¨æ‰‹åŠ¨åƒåœ¾å›æ”¶å°±å¯ä»¥äº†ã€‚

### 2. éšå¼å…¨å±€å˜é‡

å¯¹äºå…¨å±€å˜é‡ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶å¾ˆéš¾åˆ¤æ–­ä»€ä¹ˆæ—¶å€™å»å›æ”¶ï¼Œé€šå¸¸ä¸ä¼šå›æ”¶å®ƒä»¬ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é¿å…é¢å¤–å…¨å±€å˜é‡çš„ä½¿ç”¨ã€‚

```
function func3(params) {
    test = new  Array(100).fill('å¼ ä¸‰');
    this.test2 = new  Array(100).fill('å¼ ä¸‰');
};
func3();
```

æ— æ„ä¸­å…¨å±€å¢åŠ äº† test å’Œ test2 ä¸¤ä¸ªå…¨å±€å˜é‡ï¼Œé¦–å…ˆé¿å…è¿™ç§å†™æ³•ï¼Œä½¿ç”¨

```
"use strict"
```

æˆ–è€…å°±æ˜¯åŠæ—¶æ¸…ç†å…¨å±€å˜é‡ä¸­ä¸å†ä½¿ç”¨çš„å’Œé¢å¤–æ·»åŠ çš„å˜é‡ã€‚

### 3. æ¸¸ç¦» DOM å¼•ç”¨

è§‰å¾—è¿™ä¸ªä¸å¸¸ç”¨ï¼Œè¿˜æ˜¯è§£é‡Šä¸‹ï¼Œæ¸¸ç¦» DOMï¼Œæˆ‘ç†è§£çš„å°±æ˜¯çˆ¶èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œä½†æ˜¯è‡ªèº«è¿˜å­˜åœ¨å¼•ç”¨çš„èŠ‚ç‚¹ï¼Œæ— æ³• GCï¼Œéœ€è¦æ‰‹åŠ¨æŠŠçˆ¶èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å…¨éƒ¨ç½®ä¸º null,æ‰èƒ½ GCã€‚

### 4. é—å¿˜çš„å®šæ—¶å™¨

```
setInterval(() => {
    this.$axios().then();
}, 3000);
```

æ¯”å¦‚è¯´æ¯éš”ä¸‰ç§’æ›´æ–°ä¸€æ¬¡æ•°æ®ï¼Œæ²¡æœ‰åŠæ—¶æ¸…é™¤çš„æƒ…å†µä¸‹ï¼Œå®šæ—¶å™¨å¼•ç”¨çš„å˜é‡ä¹‹ç±»ä¼šä¸€ç›´å­˜åœ¨ï¼Œä¸ä¼šè¢«å›æ”¶æ‰ï¼ŒsetTimeout å’Œ cancelAnimationFrame åŒæ ·å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åŠæ—¶ç”¨ clearInterval æˆ–è€… clearTimeout æˆ–è€… cancelAnimationFrame åŠæ—¶æ¸…é™¤æ‰å®šæ—¶å™¨

### 5. é—å¿˜çš„äº‹ä»¶ç›‘å¬å™¨

```
<template>
    <div></div>
</template>
<script>
export default {
    created(){
        window.addEventListener('resize',this.func)
    },
    beforeDestroy(){
        window.removeEventListener("resize", this.func)
    },
    methods:{
        func(){}
    }
}
</script>
```

å½“äº‹ä»¶ç›‘å¬å™¨åœ¨ç»„å»ºå†…æŒ‚è½½äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç»„ä»¶é”€æ¯æ—¶ä¸ä¸»åŠ¨å°†å…¶æ¸…é™¤æ—¶ï¼Œå…¶ä¸­å¼•ç”¨çš„å˜é‡æˆ–è€…å‡½æ•°éƒ½è¢«è®¤ä¸ºæ˜¯éœ€è¦çš„è€Œä¸ä¼šè¿›è¡Œå›æ”¶ï¼Œå¦‚æœé‡Œè¾¹å¼•ç”¨äº†å¤§é‡çš„æ•°æ®ï¼Œæ¯”å¦‚è¯´è¯·æ±‚è¿”å›çš„æ•°æ®ï¼Œå¯èƒ½ä¼šå¼•èµ·é¡µé¢å†…å­˜å ç”¨è¿‡é«˜ï¼Œé€ æˆå¡é¡¿ï¼Œç”šè‡³å´©æºƒã€‚

### 6. é—å¿˜çš„ç›‘å¬è€…æ¨¡å¼

```
<template>
    <div></div>
</template>

<script>
export default {
    created() {
        eventBus.on("listener", this.func)
    },
    beforeDestroy(){
        eventBus.off("listener", this.func)
    },
    methods: {
        func() {
        // do something
        }
    }
}
</script>
```

å’Œé—å¿˜çš„äº‹ä»¶ç›‘å¬å™¨ç›¸åŒï¼Œåœ¨ beforeDestroy å‹¾å­å‡½æ•°æ¸…é™¤æ‰å³å¯ã€‚

### 7. é—å¿˜çš„ Map Sep å¯¹è±¡

å½“ä½¿ç”¨`Map`æˆ–è€…`Sep`å­˜å‚¨å¯¹è±¡æ—¶ï¼Œéƒ½æ˜¯å¯¹ Object çš„å¼ºå¼•ç”¨ï¼Œéœ€è¦ä¸»åŠ¨æ¸…é™¤å¼•ç”¨ã€‚

`WeakMap`å¯¹äºé”®æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šå¹²æ‰° GCï¼Œ`WeakSet`ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

```
//  obj å¯¹ {a :1} æ˜¯å¼ºå¼•ç”¨
let obj = {a :1};

//  map å¯¹ obj æ˜¯å¼ºå¼•ç”¨
let map = new Map();
map.set(obj,1)

//  set å¯¹ obj æ˜¯å¼ºå¼•ç”¨
let set = new Set();
set.add(obj);

obj = null;
console.log(map.size); // 1
console.log(set.size); // 1
```

æ”¹ä¸º `WeakSet WeakMap`

```
    let obj = {a :1};

    //  map å¯¹ obj æ˜¯å¼ºå¼•ç”¨
    let map = new WeakMap();
    map.set(obj,1)

    //  set å¯¹ obj æ˜¯å¼ºå¼•ç”¨
    let set = new WeakSet();
    set.add(obj);

    obj = null;
    console.log(map.size); // undefined
    console.log(set.size); // undefined
```

å¦‚ä¸Šæ‰€ç¤ºï¼Œå½“ä½¿ç”¨`WeakSet WeakMap`åï¼Œmap.size å’Œ set.size æ‰“å°ä¸º undefined,å·²ç»è¢«æ¸…ç†æ‰äº†ã€‚

### 8. æœªæ¸…ç†çš„ console

è§‰å¾—è¿™ç‚¹æ¯”è¾ƒå®¹æ˜“ç†è§£å§ï¼Œconsole.log()ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œ

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83318f625c954f039c2793947c73bbc4~tplv-k3u1fbpfcp-watermark.image)

å‡½æ•°ä¼ å‚éƒ½æ˜¯å€¼ä¼ é€’ï¼Œå¯¹å€¼çš„å¼•ç”¨ï¼Œä¼šå¯¼è‡´å†…å­˜æ¸…é™¤ä¸æ‰ï¼Œè¿™åº”è¯¥ä¼šé€ æˆå†…å­˜æ³„æ¼çš„ã€‚

### æ€»ç»“ï¼š

ä»‹ç»äº†åƒåœ¾å›æ”¶å’Œå†…å­˜æ³„æ¼ï¼Œä»¥åå†™ä»£ç çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä»å®¹çš„é¿å…è¿™äº›å‘ï¼Œè¿™ä¸ªä¹Ÿç®—ä¼˜åŒ–å§ã€‚

å‚è€ƒæ–‡ç« ï¼š

- [ç¡¬æ ¸ JSä½ çš„ç¨‹åºä¸­å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼](https://juejin.cn/post/6984188410659340324#heading-6)
- [JavaScript ä¸­çš„åƒåœ¾å›æ”¶å’Œå†…å­˜æ³„æ¼](https://juejin.cn/post/6844903833387155464)
- [åŸç”Ÿ JS çµé­‚ä¹‹é—®(ä¸‹), å†²åˆº ğŸš€ è¿›é˜¶æœ€åä¸€å…¬é‡Œ(é™„ä¸ªäººæˆé•¿ç»éªŒåˆ†äº«)](https://juejin.cn/post/6844904004007247880)
